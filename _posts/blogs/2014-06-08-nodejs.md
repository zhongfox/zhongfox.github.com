---
layout: post
categories: [blog, javascript]
tags : [nodejs]
title: nodejs
---
{% include JB/setup %}

---

### 安装

* ubuntu: `TODO`

---

### node 笔记

* 模块第一次加载后,模块对象会存入缓存,再次加载文件不会执行,直接返回缓存的模块对象对象

        % nodejs
        > a = require('m1')
        Im m1
        {}
        > a = require('m1')
        {}

* module 中的this? 反正不等于module

* 不要直接给exports赋值,因为exports是一个形参,**直接赋值形参会改变形参的引用,但是不能改变作用域外的值**, 迂回方案是给`module.exports`直接赋值

* 本地变量起一个和模块名称一样的名字是一种惯例, 如 `var http = require("http");`

* node中的全局变量属于`global`命名空间(类似浏览器中的window)

* `require`

  * `main` 主模块**对象**

    检测是否是主模块`module == require.main`

    主模块对象的id是`.`

  * `resolve(文件路径)`获得模块结对路径, 但不会加载该模块

  * `cache` 加载过的模块的hash, 键名为模块的完整路径

---

### REPL

* `_` 上次表达式的返回值, 只读不写
* 代码中打开REPL

        var repl = require('repl');
        var con = repl.start().context; # start 打开console, context用于给REPL上下文传值
        con.someVar = '...';

* 命令:

  * `.help`
  * `.break` 放弃编写
  * `.clear` 清除上下文变量
  * `.exit` 退出
  * `.save 文件名` 把输入操作命令输出到文件
  * `.load 文件名` 加载文件

---

### console

* `log` `info` 标准输出
* `error` `warn` 标准错误输出
* `dir(obj)` 检视对象
* `time(label)` `timeEnd(label)` 统计2个相同的label之间的执行时间
* `trace(label)` 将当前调用栈输出到标准错误输出
* `assert(bool判断, '错误信息')` 如果bool判断是false, 则带上错误信息抛出异常

---

### npm

* `npm info 包 version` 查看该包最新的版本
* `npm ls` `npm list` 树状列出当前项目的包(依赖关系)

  `npm ls -g` 查看全局包安装情况

* 全局安装模式:

  1. 把包放到`path.resolve(process.execPath, '..', '..', 'lib', 'node_modules')` 如`/usr/local/lib/node_modules`
  2. 在node可执行文件同目录下, 创建一个连接文件, 指向步骤1中package.json中`bin`执行的文件, 如`/usr/local/bin/express -> ../lib/node_modules/express-generator/bin/express`
* `npm root -g` 查看全局包安装路径, 即全局安装模式中1的目录
* `npm uninstall [-g] 包名` 卸载本地包或者全局包(-g)
* `npm update [-g] [包名]` 如果没有包名, 则更新全部本地(无-g)或者全局包(-g)
