---
layout: post
categories: [blog, server]
tags : [distributed]
title: 分布式系统学习
---
{% include JB/setup %}

## 概述

### 系统分类

* 集中式
* 分布式: 硬件或者软件分布在不同的网络计算机上, 彼此仅通过消息传递进行通信和协调的系统

### 特征

* 分布性

* 对等性: 没有控制系统的主机, 也没有被控制的从机

  副本概念: 数据或者服务的一种冗余方式

  * 数据副本
  * 服务副本

* 并发性

* 缺乏全局时钟: 缺乏全局时钟序列控制

* 故障总是会发生

### 分布式系统目的

* 增强系统**可用性**, 防止单点不可用
* 提高系统整体性能, **可扩展性**, 通过负载均衡提供分布式服务

### 一致性分类

* 强一致性: 体验好, 性能影响大
* 弱一致性: 一致性延迟一定时间达成
* 最终一致性: 是弱一致性的一个特例

### 分布式环境中的问题

* 通信异常:
  * 网络延迟: 单机内存访问延迟在10ns左右, 分布式在0.1~1ms, 100+倍的延迟
  * 消息丢失普遍

* 网络分区(脑裂): 只有部分节点可以正常通信, 小部分集群需要完成原本完整集群的功能

* 节点故障

### 消息三态

* 成功
* 失败
* 超时: 通信的发起方是无法确定请求是否被成功处理

---

### 事务ACID特征

单机数据库事务可以满足:

* 原子性: 只允许成功失败2中状态
* 一致性: 事务执行不能破坏数据库的完整性和一致性
* 隔离性: 并发事务相互隔离
  SQL的4个事务隔离级别: TODO
* 持久性: 事务提交后, 对数据库的变更是永久的

### 分布式事务理论

ACID模型可以保证本地事务或者集中式事务的数据严格一致性

但ACID对于分布式系统来说, 可能造成系统的可用性和严格一致性的冲突

#### CAP 理论

一个分布式系统最多同时满足一致性(C),可用性(A), 分区容错性(C)中的2个

* C 一致性: 指数据强一致性
  放弃C: 放弃强一致性, 保证最终一致性

* A 可用性: 在有限的时间内, 返回结果
  放弃A: 出现脑裂, 服务在一定时间不可用

* P 分区容错性: 出现部分网络分区(子网络或者异地机房)故障, 需要保证可用性和一致性
  放弃P: 部署在同一机房, 意味着放弃可扩展性

分区容错性是不可舍弃的, 这是分布式的特点, 因此分布式系统通常在一致性和可用性间寻求平衡

#### BaSE 理论

是对CAP重一致性和可用性权衡的一种结果

* Basically Available: 基本可用
  * 相应时间损失
  * 功能上损失(服务降级)

* Soft state: 软状态
  不影响系统可用性的, 存在于数据副本中的中间状态

* Eventually consistent: 最终一致性
  存在5类最终一致性 TODO

----

## 一致性协议

TODO
